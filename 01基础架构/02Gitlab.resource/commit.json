{"compress":true,"commitItems":[["abe2b73f-5ffe-435f-b024-dc037eddfbee",1523169621199,"",[[1523169579266,["Administrator@SC-201704281511",[[1,0,"02Gitlab\n===\n\n\n源代码管理器选用Gitlab，新版（2018.4）的Gitlab已经集成了很多的功能了，涵盖CI/CD、Issues、K8s集群/Docker集群操作等。\n\n在node1机器上安装部署Gitlab服务，Gitlab作为代码托管服务，所以需要注意备份、容灾等配置。\n\n两种安装方式：\n* [官方安装](https://about.gitlab.com/installation/#centos-7)\n* [国内镜像安装](https://mirror.tuna.tsinghua.edu.cn/help/gitlab-ce/)\n\nGitlab官方源访问太慢，我们选择国内`清华大学镜像`进行安装，首先配置源：\n\n```shell\necho -e \"[gitlab-ce]\\n\\\nname=Gitlab CE Repository\\n\\\nbaseurl=https://mirrors.tuna.tsinghua.edu.cn/gitlab-ce/yum/el$releasever/\\n\\\ngpgcheck=0\\n\\\nenabled=1\" > /etc/yum.repos.d/gitlab-ce.repo && \\\nyum makecache && \\\nyum install -y gitlab-ce\n```\n在此完成Gitlab的安装，但此时默认的一些配置还需要调整，比如[邮件配置](https://docs.gitlab.com/ce/administration/reply_by_email.html)，详细的邮件配置，参照官方文档介绍配置即可。\n配置完成后，可以在Gitlab的Admin管理页面看到配置结果：\n\n![邮件配置]($res/2018-04-08_142627.png)\n\n在Gitlab协同开发过程中，很多是依赖邮件沟通的，比如Pipelines的执行结果，Issues的处理等等。当然，我们也可以根据提供的Webhook来集成第三方的通信工具，比如钉钉。\n\n大宋这里Gitlab的基本配置就算完成了，开发人员可以将本地的git库提交到服务端了。"]],[0,0],[903,903]]],[1523169580657,["Administrator@SC-201704281511",[[-1,14,"\n"]],[13,13],[12,12]]],[1523169581689,["Administrator@SC-201704281511",[[-1,13,"\n"]],[13,13],[12,12]]],[1523169615186,["Administrator@SC-201704281511",[[-1,858,"大宋"],[1,860," "]],[858,860],[858,859]]],[1523169615811,["Administrator@SC-201704281511",[[-1,858," "],[1,859,"到"]],[858,859],[859,859]]],[1523169618619,["Administrator@SC-201704281511",[[1,861,"，"]],[861,861],[862,862]]],[1523169619474,["Administrator@SC-201704281511",[[1,858,"\n"]],[857,857],[858,858]]],[1523169620418,["Administrator@SC-201704281511",[[1,859,"\n"]],[857,857],[858,858]]],[1523169623211,["Administrator@SC-201704281511",[[1,858,"自动备份"]],[858,858],[862,862]]],[1523169624235,["Administrator@SC-201704281511",[[1,858,"# "]],[858,858],[860,860]]],[1523169631148,["Administrator@SC-201704281511",[[1,0,"@"]],[0,0],[1,1]]],[1523169631585,["Administrator@SC-201704281511",[[-1,0,"@"]],[1,1],[0,0]]],[1523169632091,["Administrator@SC-201704281511",[[1,0,"# "]],[0,0],[2,2]]],[1523169637423,["Administrator@SC-201704281511",[[-1,861," "]],[860,862],[861,861]]],[1523169637843,["Administrator@SC-201704281511",[[1,861,"# "]],[861,861],[863,863]]],[1523169640001,["Administrator@SC-201704281511",[[-1,0,"# "]],[0,2],[0,0]]],[1523169642657,["Administrator@SC-201704281511",[[1,867,"\n"]],[865,865],[866,866]]],[1523169643322,["Administrator@SC-201704281511",[[1,868,"\n"]],[866,866],[867,867]]],[1523169644185,["Administrator@SC-201704281511",[[1,869,"\n"]],[866,866],[867,867]]],[1523169645869,["Administrator@SC-201704281511",[[1,867,"待"]],[867,867],[868,868]]],[1523169646010,["Administrator@SC-201704281511",[[-1,867,"待"]],[868,868],[867,867]]],[1523169654270,["Administrator@SC-201704281511",[[1,867,"仓库需要日常的自动备份，进行荣菜"]],[867,867],[883,883]]],[1523169654546,["Administrator@SC-201704281511",[[-1,881,"荣菜"]],[883,883],[881,881]]],[1523169657660,["Administrator@SC-201704281511",[[1,881,"容灾处理，搞"]],[881,881],[887,887]]],[1523169662105,["Administrator@SC-201704281511",[[-1,885,"，搞"]],[887,887],[885,885]]],[1523169666617,["Administrator@SC-201704281511",[[1,885,"。Gitlab提供了字"]],[885,885],[896,896]]],[1523169667561,["Administrator@SC-201704281511",[[-1,892,"提供了字"]],[896,896],[892,892]]],[1523169671380,["Administrator@SC-201704281511",[[1,892,"本身已经提供被"]],[892,892],[899,899]]],[1523169671545,["Administrator@SC-201704281511",[[-1,898,"被"]],[899,899],[898,898]]],[1523169678276,["Administrator@SC-201704281511",[[1,898,"了备份导出的功能了，所以我们"]],[898,898],[912,912]]],[1523169678954,["Administrator@SC-201704281511",[[-1,910,"我们"]],[912,912],[910,910]]],[1523169680363,["Administrator@SC-201704281511",[[1,910,"只要"]],[910,910],[912,912]]],[1523169680681,["Administrator@SC-201704281511",[[-1,910,"只要"]],[912,912],[910,910]]],[1523169683748,["Administrator@SC-201704281511",[[1,910,"只要发"]],[910,910],[913,913]]],[1523169683881,["Administrator@SC-201704281511",[[-1,912,"发"]],[913,913],[912,912]]],[1523169687508,["Administrator@SC-201704281511",[[1,912,"配置一个Job就行了。"]],[912,912],[923,923]]],[1523169689785,["Administrator@SC-201704281511",[[1,926,"\n"]],[924,924],[925,925]]],[1523169695970,["Administrator@SC-201704281511",[[1,925,"在CronTab中"]],[925,925],[934,934]]],[1523169696633,["Administrator@SC-201704281511",[[-1,930,"Tab中"]],[934,934],[930,930]]],[1523169700739,["Administrator@SC-201704281511",[[1,930,"tab中增加一下"]],[930,930],[938,938]]],[1523169701480,["Administrator@SC-201704281511",[[-1,936,"一下"]],[938,938],[936,936]]],[1523169702165,["Administrator@SC-201704281511",[[1,936,"胰腺癌"]],[936,936],[939,939]]],[1523169703105,["Administrator@SC-201704281511",[[-1,936,"胰腺癌"]],[939,939],[936,936]]],[1523169707426,["Administrator@SC-201704281511",[[1,936,"以下语句："]],[936,936],[941,941]]],[1523169708016,["Administrator@SC-201704281511",[[1,943,"\n"]],[941,941],[942,942]]],[1523169708153,["Administrator@SC-201704281511",[[1,944,"\n"]],[942,942],[943,943]]],[1523169710027,["Administrator@SC-201704281511",[[1,943,"```"]],[943,943],[946,946]]],[1523169710744,["Administrator@SC-201704281511",[[1,948,"\n"]],[946,946],[947,947]]],[1523169710872,["Administrator@SC-201704281511",[[1,949,"\n"]],[947,947],[948,948]]],[1523169711282,["Administrator@SC-201704281511",[[1,948,"```"]],[948,948],[951,951]]],[1523169713498,["Administrator@SC-201704281511",[[1,946,"shell"]],[946,946],[951,951]]],[1523169741240,["Administrator@SC-201704281511",[[1,952,"0 5 * * 1 gitlab-rake gitlab:backup:create"]],[952,952],[994,994]]],[1523169744776,["Administrator@SC-201704281511",[[1,1000,"\n"]],[998,998],[999,999]]],[1523169749443,["Administrator@SC-201704281511",[[1,999,"anzha"]],[999,999],[1004,1004]]],[1523169750337,["Administrator@SC-201704281511",[[-1,999,"anzha"]],[1004,1004],[999,999]]],[1523169752652,["Administrator@SC-201704281511",[[1,999,"按照培峰"]],[999,999],[1003,1003]]],[1523169752939,["Administrator@SC-201704281511",[[-1,1001,"培峰"]],[1003,1003],[1001,1001]]],[1523169753708,["Administrator@SC-201704281511",[[1,1001,"备份"]],[1001,1001],[1003,1003]]],[1523169756451,["Administrator@SC-201704281511",[[-1,999,"按照备份"]],[1003,1003],[999,999]]],[1523169769645,["Administrator@SC-201704281511",[[1,999,"以上代码将在每周的凌晨5店进行圈梁"]],[999,999],[1016,1016]]],[1523169770489,["Administrator@SC-201704281511",[[-1,1014,"圈梁"]],[1016,1016],[1014,1014]]],[1523169776181,["Administrator@SC-201704281511",[[1,1014,"全量备份，备份文件"]],[1014,1014],[1023,1023]]],[1523169777841,["Administrator@SC-201704281511",[[-1,1019,"备份文件"]],[1023,1023],[1019,1019]]],[1523169782036,["Administrator@SC-201704281511",[[1,1019,"备份完成后将生产一个"]],[1019,1019],[1029,1029]]],[1523169782394,["Administrator@SC-201704281511",[[-1,1027,"一个"]],[1029,1029],[1027,1027]]],[1523169785949,["Administrator@SC-201704281511",[[1,1027,"一个.tag的包"]],[1027,1027],[1035,1035]]],[1523169794601,["Administrator@SC-201704281511",[[-1,1032,"g"],[1,1033," "]],[1032,1033],[1032,1033]]],[1523169795253,["Administrator@SC-201704281511",[[-1,1032," "],[1,1033,"r"]],[1032,1033],[1033,1033]]],[1523169801309,["Administrator@SC-201704281511",[[1,1035,"存放在"]],[1035,1035],[1038,1038]]],[1523169818995,["Administrator@SC-201704281511",[[1,1035,"， "]],[1035,1035],[1037,1037]]],[1523169821113,["Administrator@SC-201704281511",[[-1,1036," "]],[1037,1037],[1036,1036]]],[1523169821966,["Administrator@SC-201704281511",[[1,1036,"默认"]],[1036,1036],[1038,1038]]],[1523169823843,["Administrator@SC-201704281511",[[1,1041,"``"]],[1041,1041],[1043,1043]]],[1523169824202,["Administrator@SC-201704281511",[[1,1042,"/var/opt/gitlab/backups"]],[1042,1042],[1065,1065]]],[1523169826667,["Administrator@SC-201704281511",[[1,1066,"."]],[1066,1066],[1067,1067]]],[1523169827361,["Administrator@SC-201704281511",[[-1,1066,"."]],[1067,1067],[1066,1066]]],[1523169827667,["Administrator@SC-201704281511",[[1,1066,"。"]],[1066,1066],[1067,1067]]],[1523169828321,["Administrator@SC-201704281511",[[1,1069,"\n"]],[1067,1067],[1068,1068]]],[1523169840300,["Administrator@SC-201704281511",[[1,1068,"可以通过修改配置文件调整存储的位置，也可以佩芬"]],[1068,1068],[1091,1091]]],[1523169840754,["Administrator@SC-201704281511",[[-1,1089,"佩芬"]],[1091,1091],[1089,1089]]],[1523169855572,["Administrator@SC-201704281511",[[1,1089,"备份完成后将其上"]],[1089,1089],[1097,1097]]],[1523169855793,["Administrator@SC-201704281511",[[-1,1096,"上"]],[1097,1097],[1096,1096]]],[1523169859876,["Administrator@SC-201704281511",[[1,1096,"自动上传到专用的"]],[1096,1096],[1104,1104]]],[1523169879497,["Administrator@SC-201704281511",[[1,1104,"NAS备份存储。"]],[1104,1104],[1112,1112]]],[1523169881457,["Administrator@SC-201704281511",[[1,1114,"\n"]],[1112,1112],[1113,1113]]],[1523169882017,["Administrator@SC-201704281511",[[1,1115,"\n"]],[1113,1113],[1114,1114]]],[1523169882761,["Administrator@SC-201704281511",[[1,1114,"```"]],[1114,1114],[1117,1117]]],[1523169883113,["Administrator@SC-201704281511",[[1,1119,"\n"]],[1117,1117],[1118,1118]]],[1523169883256,["Administrator@SC-201704281511",[[1,1120,"\n"]],[1118,1118],[1119,1119]]],[1523169883673,["Administrator@SC-201704281511",[[1,1119,"```"]],[1119,1119],[1122,1122]]],[1523169886561,["Administrator@SC-201704281511",[[1,1117,"shell"]],[1117,1117],[1122,1122]]],[1523169892265,["Administrator@SC-201704281511",[[1,1123,"gitlab_rails['backup_path'] = '/mnt/backups'"]],[1123,1123],[1167,1167]]],[1523169898377,["Administrator@SC-201704281511",[[-1,1155,"mnt"],[1,1158,"var/opt/gitlab"]],[1154,1166],[1177,1177]]],[1523169900777,["Administrator@SC-201704281511",[[1,1178," #xiu"]],[1178,1178],[1183,1183]]],[1523169901408,["Administrator@SC-201704281511",[[-1,1180,"xiu"]],[1183,1183],[1180,1180]]],[1523169904370,["Administrator@SC-201704281511",[[1,1180," 修改此处即可"]],[1180,1180],[1187,1187]]]]],["3f46c579-7539-4a58-8f16-81ac775ee74d",1523173649076,"02Gitlab\n===\n源代码管理器选用Gitlab，新版（2018.4）的Gitlab已经集成了很多的功能了，涵盖CI/CD、Issues、K8s集群/Docker集群操作等。\n\n在node1机器上安装部署Gitlab服务，Gitlab作为代码托管服务，所以需要注意备份、容灾等配置。\n\n两种安装方式：\n* [官方安装](https://about.gitlab.com/installation/#centos-7)\n* [国内镜像安装](https://mirror.tuna.tsinghua.edu.cn/help/gitlab-ce/)\n\nGitlab官方源访问太慢，我们选择国内`清华大学镜像`进行安装，首先配置源：\n\n```shell\necho -e \"[gitlab-ce]\\n\\\nname=Gitlab CE Repository\\n\\\nbaseurl=https://mirrors.tuna.tsinghua.edu.cn/gitlab-ce/yum/el$releasever/\\n\\\ngpgcheck=0\\n\\\nenabled=1\" > /etc/yum.repos.d/gitlab-ce.repo && \\\nyum makecache && \\\nyum install -y gitlab-ce\n```\n在此完成Gitlab的安装，但此时默认的一些配置还需要调整，比如[邮件配置](https://docs.gitlab.com/ce/administration/reply_by_email.html)，详细的邮件配置，参照官方文档介绍配置即可。\n配置完成后，可以在Gitlab的Admin管理页面看到配置结果：\n\n![邮件配置]($res/2018-04-08_142627.png)\n\n在Gitlab协同开发过程中，很多是依赖邮件沟通的，比如Pipelines的执行结果，Issues的处理等等。当然，我们也可以根据提供的Webhook来集成第三方的通信工具，比如钉钉。\n\n## 自动备份\n\n仓库需要日常的自动备份，进行容灾处理。Gitlab本身已经提供了备份导出的功能了，所以只要配置一个Job就行了。\n\n在Crontab中增加以下语句：\n\n```shell\n0 5 * * 1 gitlab-rake gitlab:backup:create\n```\n以上代码将在每周的凌晨5店进行全量备份，备份完成后将生产一个.tar的包，默认存放在`/var/opt/gitlab/backups`。\n可以通过修改配置文件调整存储的位置，也可以备份完成后将其自动上传到专用的NAS备份存储。\n\n```shell\ngitlab_rails['backup_path'] = '/var/opt/gitlab/backups' # 修改此处即可\n```\n\n到这里，Gitlab的基本配置就算完成了，开发人员可以将本地的git库提交到服务端了。",[[1523173648483,["Administrator@SC-201704281511",[[1,97,"0"]],[97,97],[98,98]]],[1523175127344,["Administrator@SC-201704281511",[[1,566,"\n"]],[565,565],[566,566]]],[1523175127472,["Administrator@SC-201704281511",[[1,567,"\n"]],[566,566],[567,567]]],[1523175128305,["Administrator@SC-201704281511",[[1,567,"cat > goim.sh << END_TEXT\n#!/bin/bash\ntar -xzvf /data/apps/go/bin/admin/admin.tar.gz -C /data/apps/go/bin/admin/\nkillall -9 router\nkillall -9 logic\nkillall -9 comet\nkillall -9 job\nkillall -9 admin\nnohup /data/apps/go/bin/router -c /data/apps/go/bin/router.conf 2>&1 > /data/logs/goim/panic-router.log &\nnohup /data/apps/go/bin/logic -c /data/apps/go/bin/logic.conf 2>&1 > /data/logs/goim/panic-logic.log &\nnohup /data/apps/go/bin/comet -c /data/apps/go/bin/comet.conf 2>&1 > /data/logs/goim/panic-comet.log &\nnohup /data/apps/go/bin/job -c /data/apps/go/bin/job.conf 2>&1 > /data/logs/goim/panic-job.log &\ncd /data/apps/go/bin/admin\nnohup ./admin 2>&1 > /data/logs/goim/panic-admin.log &\nEND_TEXT\n"]],[567,567],[1264,1264]]],[1523175130673,["Administrator@SC-201704281511",[[-1,1264,"\n"]],[1264,1264],[1263,1263]]],[1523175134073,["Administrator@SC-201704281511",[[-1,593,"#!/bin/bash\ntar -xzvf /data/apps/go/bin/admin/admin.tar.gz -C /data/apps/go/bin/admin/\nkillall -9 router\nkillall -9 logic\nkillall -9 comet\nkillall -9 job\nkillall -9 admin\nnohup /data/apps/go/bin/router -c /data/apps/go/bin/router.conf 2>&1 > /data/logs/goim/panic-router.log &\nnohup /data/apps/go/bin/logic -c /data/apps/go/bin/logic.conf 2>&1 > /data/logs/goim/panic-logic.log &\nnohup /data/apps/go/bin/comet -c /data/apps/go/bin/comet.conf 2>&1 > /data/logs/goim/panic-comet.log &\nnohup /data/apps/go/bin/job -c /data/apps/go/bin/job.conf 2>&1 > /data/logs/goim/panic-job.log &\ncd /data/apps/go/bin/admin\nnohup ./admin 2>&1 > /data/logs/goim/panic-admin.log &\n"]],[592,1254],[592,592]]],[1523175143129,["Administrator@SC-201704281511",[[1,593,"\n"]],[592,592],[593,593]]],[1523175143304,["Administrator@SC-201704281511",[[1,593,"[gitlab-ce]\\n\\\nname=Gitlab CE Repository\\n\\\nbaseurl=https://mirrors.tuna.tsinghua.edu.cn/gitlab-ce/yum/el$releasever/\\n\\\ngpgcheck=0\\n\\\nenabled=1\" > /etc/yum.repos.d/gitlab-ce.repo && \\\nyum makecache && \\\nyum install -y gitlab-ce"]],[593,593],[821,821]]],[1523175145523,["Administrator@SC-201704281511",[[-1,604,"\\n\\"]],[604,607],[604,604]]],[1523175147121,["Administrator@SC-201704281511",[[-1,630,"\\n\\"]],[633,633],[630,630]]],[1523175149528,["Administrator@SC-201704281511",[[-1,704,"\\n\\"]],[704,707],[704,704]]],[1523175150472,["Administrator@SC-201704281511",[[-1,715,"\\n\\"]],[715,718],[715,715]]],[1523175156455,["Administrator@SC-201704281511",[[1,715,"\\n\\"]],[715,715],[715,718]]],[1523175156648,["Administrator@SC-201704281511",[[1,704,"\\n\\"]],[704,704],[704,707]]],[1523175156840,["Administrator@SC-201704281511",[[1,630,"\\n\\"]],[630,630],[633,633]]],[1523175157024,["Administrator@SC-201704281511",[[1,604,"\\n\\"]],[604,604],[604,607]]],[1523175157216,["Administrator@SC-201704281511",[[-1,593,"[gitlab-ce]\\n\\\nname=Gitlab CE Repository\\n\\\nbaseurl=https://mirrors.tuna.tsinghua.edu.cn/gitlab-ce/yum/el$releasever/\\n\\\ngpgcheck=0\\n\\\nenabled=1\" > /etc/yum.repos.d/gitlab-ce.repo && \\\nyum makecache && \\\nyum install -y gitlab-ce"]],[821,821],[593,593]]],[1523175157400,["Administrator@SC-201704281511",[[-1,593,"\n"]],[593,593],[592,592]]],[1523175157585,["Administrator@SC-201704281511",[[1,593,"#!/bin/bash\ntar -xzvf /data/apps/go/bin/admin/admin.tar.gz -C /data/apps/go/bin/admin/\nkillall -9 router\nkillall -9 logic\nkillall -9 comet\nkillall -9 job\nkillall -9 admin\nnohup /data/apps/go/bin/router -c /data/apps/go/bin/router.conf 2>&1 > /data/logs/goim/panic-router.log &\nnohup /data/apps/go/bin/logic -c /data/apps/go/bin/logic.conf 2>&1 > /data/logs/goim/panic-logic.log &\nnohup /data/apps/go/bin/comet -c /data/apps/go/bin/comet.conf 2>&1 > /data/logs/goim/panic-comet.log &\nnohup /data/apps/go/bin/job -c /data/apps/go/bin/job.conf 2>&1 > /data/logs/goim/panic-job.log &\ncd /data/apps/go/bin/admin\nnohup ./admin 2>&1 > /data/logs/goim/panic-admin.log &\n"]],[592,592],[592,1254]]],[1523175157793,["Administrator@SC-201704281511",[[1,1264,"\n"]],[1263,1263],[1264,1264]]],[1523175158009,["Administrator@SC-201704281511",[[-1,567,"cat > goim.sh << END_TEXT\n#!/bin/bash\ntar -xzvf /data/apps/go/bin/admin/admin.tar.gz -C /data/apps/go/bin/admin/\nkillall -9 router\nkillall -9 logic\nkillall -9 comet\nkillall -9 job\nkillall -9 admin\nnohup /data/apps/go/bin/router -c /data/apps/go/bin/router.conf 2>&1 > /data/logs/goim/panic-router.log &\nnohup /data/apps/go/bin/logic -c /data/apps/go/bin/logic.conf 2>&1 > /data/logs/goim/panic-logic.log &\nnohup /data/apps/go/bin/comet -c /data/apps/go/bin/comet.conf 2>&1 > /data/logs/goim/panic-comet.log &\nnohup /data/apps/go/bin/job -c /data/apps/go/bin/job.conf 2>&1 > /data/logs/goim/panic-job.log &\ncd /data/apps/go/bin/admin\nnohup ./admin 2>&1 > /data/logs/goim/panic-admin.log &\nEND_TEXT\n"]],[1264,1264],[567,567]]],[1523175158231,["Administrator@SC-201704281511",[[-1,567,"\n"]],[567,567],[566,566]]],[1523175158639,["Administrator@SC-201704281511",[[-1,566,"\n"]],[566,566],[565,565]]]]]]}